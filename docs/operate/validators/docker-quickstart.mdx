import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Production quickstart with docker and AWS on mainnet

### 1. Setup validator key

Follow the guide [here](../set-up-agent-keys.mdx#2-aws-kms) for creating agent keys with AWS KMS.

### 2. Create S3 bucket for signatures

Follow the guide [here](./validator-signatures-aws.mdx) for creating and configuring an S3 bucket for your validator to write signatures to.

### 3. (AVS Operators Only) Register with Hyperlane AVS

If you are an AVS operator, follow the guide [here](../../guides/avs-operator-guide#4-register-your-operator) to register with the Hyperlane AVS.

## 4. Setup validator environment

### Create a directory for each chain you wish to validate

For example, create an ethereum directory and create config.json, docker-compose.yml, and .env
```bash
mkdir -p ethereum/hyperlane_db && \
touch ethereum/config.json ethereum/docker-compose.yml ethereum/.env
```

### Edit config.json

`customRpcUrls` are a comma separated list of performant RPC endpoints for the chain you wish to support, we recommend using paid providers to avoid rate limiting

`signer.region` and `validator.region` should be adjusted to your AWS region

`signer.id` and `validator.id` should be adjusted to your AWS KMS id you configured in step 3, prefixed with `alias/`

`originChainName` should be the chain you are validating

`checkpointSyncer.bucket` should reflect the name of the S3 bucket

`checkpointSyncer.folder` is the name of the folder the validator will use within the bucket (you may use the same bucket for multiple validators, but ensure each folder name is unique per validator)

`reorgPeriod` may be different for each chain [**find the reorgPeriods**](https://github.com/hyperlane-xyz/hyperlane-registry/tree/main/chains)

```json
{
  "chains": {
    "ethereum": {
      "customRpcUrls": "https://eth.llamarpc.com,https://rpc.mevblocker.io",
      "signer": {
        "region": "us-east-1",
        "type": "aws",
        "id": "alias/hyperlane-validator-signer-ethereum"
      }
    }
  },
  "originChainName": "ethereum",
  "db": "/mnt/hyperlane_db",
  "validator": {
    "id": "alias/hyperlane-validator-signer-ethereum",
    "type": "aws",
    "region": "us-east-1"
  },
  "checkpointSyncer": {
    "bucket": "hyperlane-validator-signatures-ethereum",
    "region": "us-east-1",
    "type": "s3",
    "folder": "ethereum"
  },
  "reorgPeriod": 14,
  "metricsPort": "9090"
}
```

### Edit .env

```
AWS_ACCESS_KEY_ID=<Your AWS access key ID>
AWS_SECRET_ACCESS_KEY=<Your AWS secret access key>
DB_PATH=./hyperlane_db # ./hyperlane_db
METRICS_PORT=9091 # Default is 9090, should match port set in config.json
CONFIG_FILE=./config.json # ./config.json
SERVICE_NAME=ethereum
```

### Edit docker-compose.yml

If you wish to run multiple validators, you could reuse the same docker-compose file but create different .env and config.json files per chain. 

```yaml
version: '3.8' 

services:
  validator:
    image: gcr.io/abacus-labs-dev/hyperlane-agent:7a8478b-20240703-113821
    command: ./validator
    container_name: ${SERVICE_NAME-validator}
    ports:
      - "${METRICS_PORT}:9090/tcp"
    environment:
      CONFIG_FILES: /config.json
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
    configs:
      - config.json
    volumes:
      - ${DB_PATH}:/mnt/hyperlane_db
    restart: unless-stopped  # Ensure the container restarts unless explicitly stopped
    env_file:
      - .env

configs:
  config.json:
    file: ${CONFIG_FILE}
```

## 6. Run the Hyperlane validators

Bring the containers up:

```bash
cd ethereum && docker-compose up -d
```

Ensure there are no errors:

```bash
docker logs -f ethereum-validator
```

